<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SprintSync</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --surface2: #1a1a26;
    --border: #2a2a3a;
    --accent: #7c6aff;
    --accent2: #ff6a8a;
    --accent3: #6affd4;
    --text: #e8e8f0;
    --text2: #7878a0;
    --todo: #7c6aff;
    --inprogress: #ffb86a;
    --done: #6affd4;
    --radius: 12px;
    --mono: 'Space Mono', monospace;
    --sans: 'Syne', sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--sans);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Background grid */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(124,106,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(124,106,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ */
  #auth-screen {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    background: var(--bg);
  }

  .auth-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 48px;
    width: 420px;
    position: relative;
    overflow: hidden;
    animation: slideUp 0.5s ease;
  }

  .auth-card::before {
    content: '';
    position: absolute;
    top: -80px; left: -80px;
    width: 200px; height: 200px;
    background: radial-gradient(circle, rgba(124,106,255,0.15), transparent 70%);
    pointer-events: none;
  }

  .auth-card::after {
    content: '';
    position: absolute;
    bottom: -80px; right: -80px;
    width: 200px; height: 200px;
    background: radial-gradient(circle, rgba(255,106,138,0.1), transparent 70%);
    pointer-events: none;
  }

  .auth-logo {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: -1px;
    margin-bottom: 8px;
  }

  .auth-logo span { color: var(--accent); }

  .auth-subtitle {
    color: var(--text2);
    font-size: 14px;
    margin-bottom: 36px;
    font-family: var(--mono);
  }

  .auth-tabs {
    display: flex;
    gap: 4px;
    background: var(--bg);
    border-radius: 8px;
    padding: 4px;
    margin-bottom: 28px;
  }

  .auth-tab {
    flex: 1;
    padding: 8px;
    border: none;
    background: transparent;
    color: var(--text2);
    font-family: var(--sans);
    font-size: 14px;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .auth-tab.active {
    background: var(--accent);
    color: white;
  }

  .field {
    margin-bottom: 16px;
  }

  .field label {
    display: block;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--text2);
    margin-bottom: 8px;
    font-family: var(--mono);
  }

  .field input {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 16px;
    color: var(--text);
    font-family: var(--mono);
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .field input:focus {
    border-color: var(--accent);
  }

  .btn-primary {
    width: 100%;
    padding: 14px;
    background: var(--accent);
    border: none;
    border-radius: 8px;
    color: white;
    font-family: var(--sans);
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    margin-top: 8px;
    position: relative;
    overflow: hidden;
  }

  .btn-primary:hover {
    background: #9580ff;
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(124,106,255,0.3);
  }

  .btn-primary:active { transform: translateY(0); }

  .btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .error-msg {
    background: rgba(255,106,138,0.1);
    border: 1px solid rgba(255,106,138,0.3);
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 13px;
    color: var(--accent2);
    margin-top: 12px;
    font-family: var(--mono);
    display: none;
  }

  /* ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ */
  #app-screen { display: none; position: relative; z-index: 1; }

  /* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
  .topbar {
    position: sticky;
    top: 0;
    z-index: 50;
    background: rgba(10,10,15,0.85);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .topbar-logo {
    font-size: 22px;
    font-weight: 800;
    letter-spacing: -0.5px;
  }

  .topbar-logo span { color: var(--accent); }

  .topbar-right {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .user-pill {
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 100px;
    padding: 6px 16px 6px 6px;
  }

  .user-avatar {
    width: 32px; height: 32px;
    background: var(--accent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 700;
    color: white;
  }

  .user-email {
    font-size: 13px;
    font-family: var(--mono);
    color: var(--text2);
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .btn-logout {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text2);
    font-family: var(--sans);
    font-size: 13px;
    font-weight: 600;
    padding: 8px 16px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-logout:hover {
    border-color: var(--accent2);
    color: var(--accent2);
  }

  /* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
  .main {
    max-width: 1300px;
    margin: 0 auto;
    padding: 40px 32px;
  }

  /* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
  .page-header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    margin-bottom: 40px;
  }

  .page-title {
    font-size: 40px;
    font-weight: 800;
    letter-spacing: -2px;
    line-height: 1;
  }

  .page-title span { color: var(--accent); }

  .page-subtitle {
    color: var(--text2);
    font-family: var(--mono);
    font-size: 13px;
    margin-top: 8px;
  }

  .btn-new-task {
    background: var(--accent);
    border: none;
    border-radius: 10px;
    color: white;
    font-family: var(--sans);
    font-size: 14px;
    font-weight: 700;
    padding: 12px 24px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
  }

  .btn-new-task:hover {
    background: #9580ff;
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(124,106,255,0.3);
  }

  /* ‚îÄ‚îÄ STATS ROW ‚îÄ‚îÄ */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 40px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: border-color 0.2s;
  }

  .stat-card:hover { border-color: var(--accent); }

  .stat-label {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--text2);
    font-family: var(--mono);
    margin-bottom: 6px;
  }

  .stat-value {
    font-size: 32px;
    font-weight: 800;
    letter-spacing: -1px;
  }

  .stat-dot {
    width: 40px; height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
  }

  /* ‚îÄ‚îÄ BOARD ‚îÄ‚îÄ */
  .board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    align-items: start;
  }

  .column {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
  }

  .column-header {
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
  }

  .column-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-family: var(--mono);
  }

  .column-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
  }

  .col-todo .column-dot { background: var(--todo); }
  .col-inprogress .column-dot { background: var(--inprogress); }
  .col-done .column-dot { background: var(--done); }

  .column-count {
    font-family: var(--mono);
    font-size: 12px;
    color: var(--text2);
    background: var(--bg);
    border-radius: 100px;
    padding: 2px 10px;
  }

  .column-body {
    padding: 12px;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  /* ‚îÄ‚îÄ TASK CARD ‚îÄ‚îÄ */
  .task-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.2s;
    animation: fadeIn 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .task-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 3px;
    border-radius: 3px 0 0 3px;
  }

  .col-todo .task-card::before { background: var(--todo); }
  .col-inprogress .task-card::before { background: var(--inprogress); }
  .col-done .task-card::before { background: var(--done); }

  .task-card:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  }

  .task-title {
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 6px;
    line-height: 1.4;
  }

  .task-desc {
    font-size: 12px;
    color: var(--text2);
    line-height: 1.5;
    margin-bottom: 12px;
    font-family: var(--mono);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .task-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .task-minutes {
    font-size: 11px;
    font-family: var(--mono);
    color: var(--text2);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .task-actions {
    display: flex;
    gap: 6px;
  }

  .task-btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text2);
    font-size: 11px;
    font-family: var(--mono);
    padding: 4px 10px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .task-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .task-btn.advance {
    border-color: rgba(124,106,255,0.3);
    color: var(--accent);
  }

  .task-btn.advance:hover {
    background: rgba(124,106,255,0.1);
  }

  .task-btn.danger:hover {
    border-color: var(--accent2);
    color: var(--accent2);
  }

  .empty-col {
    text-align: center;
    padding: 32px 16px;
    color: var(--text2);
    font-size: 13px;
    font-family: var(--mono);
  }

  /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(8px);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }

  .modal-overlay.open {
    opacity: 1;
    pointer-events: all;
  }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 36px;
    width: 520px;
    max-width: 95vw;
    position: relative;
    transform: translateY(20px);
    transition: transform 0.3s;
    max-height: 90vh;
    overflow-y: auto;
  }

  .modal-overlay.open .modal {
    transform: translateY(0);
  }

  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 28px;
  }

  .modal-title {
    font-size: 22px;
    font-weight: 800;
    letter-spacing: -0.5px;
  }

  .modal-close {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text2);
    width: 36px; height: 36px;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }

  .modal-close:hover {
    border-color: var(--accent2);
    color: var(--accent2);
  }

  textarea {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 16px;
    color: var(--text);
    font-family: var(--mono);
    font-size: 13px;
    outline: none;
    resize: vertical;
    min-height: 100px;
    transition: border-color 0.2s;
    line-height: 1.6;
  }

  textarea:focus { border-color: var(--accent); }

  select {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 16px;
    color: var(--text);
    font-family: var(--mono);
    font-size: 13px;
    outline: none;
    transition: border-color 0.2s;
    cursor: pointer;
  }

  select:focus { border-color: var(--accent); }

  .ai-row {
    display: flex;
    gap: 10px;
    align-items: flex-start;
  }

  .ai-row .field { flex: 1; margin: 0; }

  .btn-ai {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 8px;
    color: white;
    font-family: var(--sans);
    font-size: 13px;
    font-weight: 700;
    padding: 12px 18px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 26px;
    height: 46px;
  }

  .btn-ai:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(124,106,255,0.4);
  }

  .btn-ai:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .ai-badge {
    font-size: 10px;
    background: rgba(106,255,212,0.15);
    border: 1px solid rgba(106,255,212,0.3);
    color: var(--accent3);
    border-radius: 4px;
    padding: 2px 6px;
    font-family: var(--mono);
    font-weight: 700;
    letter-spacing: 0.5px;
  }

  .modal-footer {
    display: flex;
    gap: 10px;
    margin-top: 28px;
    justify-content: flex-end;
  }

  .btn-secondary {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text2);
    font-family: var(--sans);
    font-size: 14px;
    font-weight: 600;
    padding: 12px 24px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-secondary:hover {
    border-color: var(--text);
    color: var(--text);
  }

  .btn-submit {
    background: var(--accent);
    border: none;
    border-radius: 8px;
    color: white;
    font-family: var(--sans);
    font-size: 14px;
    font-weight: 700;
    padding: 12px 28px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-submit:hover {
    background: #9580ff;
    box-shadow: 0 6px 20px rgba(124,106,255,0.3);
  }

  .btn-submit:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  .toast-container {
    position: fixed;
    bottom: 32px;
    right: 32px;
    z-index: 999;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .toast {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 20px;
    font-size: 13px;
    font-family: var(--mono);
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideInRight 0.3s ease;
    min-width: 280px;
  }

  .toast.success { border-color: var(--accent3); }
  .toast.error { border-color: var(--accent2); }
  .toast.info { border-color: var(--accent); }

  /* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
  .spinner {
    display: inline-block;
    width: 14px; height: 14px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
  }

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideInRight {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .loading-text {
    animation: pulse 1.2s ease infinite;
    color: var(--text2);
    font-family: var(--mono);
    font-size: 13px;
  }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ -->
<div id="auth-screen">
  <div class="auth-card">
    <div class="auth-logo">Sprint<span>Sync</span></div>
    <div class="auth-subtitle">// lean sprint management + AI assist</div>

    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">Login</button>
      <button class="auth-tab" onclick="switchTab('register')">Register</button>
    </div>

    <div id="login-form">
      <div class="field">
        <label>Email</label>
        <input type="email" id="login-email" placeholder="alice@sprintsync.dev" />
      </div>
      <div class="field">
        <label>Password</label>
        <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </div>
      <button class="btn-primary" onclick="handleLogin()">
        <span id="login-btn-text">Login</span>
      </button>
    </div>

    <div id="register-form" style="display:none">
      <div class="field">
        <label>Email</label>
        <input type="email" id="reg-email" placeholder="you@example.com" />
      </div>
      <div class="field">
        <label>Password</label>
        <input type="password" id="reg-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </div>
      <button class="btn-primary" onclick="handleRegister()">
        <span id="reg-btn-text">Create Account</span>
      </button>
    </div>

    <div class="error-msg" id="auth-error"></div>

    <div style="margin-top:20px; padding-top:20px; border-top:1px solid var(--border)">
      <div style="font-size:11px; color:var(--text2); font-family:var(--mono); margin-bottom:8px">// demo accounts</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <button onclick="fillDemo('alice@sprintsync.dev','alice123')" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-family:var(--mono);font-size:11px;padding:6px 10px;cursor:pointer">alice / alice123</button>
        <button onclick="fillDemo('bob@sprintsync.dev','bob123')" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-family:var(--mono);font-size:11px;padding:6px 10px;cursor:pointer">bob / bob123</button>
        <button onclick="fillDemo('admin@sprintsync.dev','admin123')" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-family:var(--mono);font-size:11px;padding:6px 10px;cursor:pointer">admin / admin123</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ APP SCREEN ‚îÄ‚îÄ -->
<div id="app-screen">
  <!-- Topbar -->
  <div class="topbar">
    <div class="topbar-logo">Sprint<span>Sync</span></div>
    <div class="topbar-right">
      <div class="user-pill">
        <div class="user-avatar" id="user-avatar">A</div>
        <div class="user-email" id="user-email-display">loading...</div>
      </div>
      <button class="btn-logout" onclick="handleLogout()">Logout</button>
    </div>
  </div>

  <!-- Main -->
  <div class="main">
    <!-- Page header -->
    <div class="page-header">
      <div>
        <div class="page-title">My <span>Sprint</span></div>
        <div class="page-subtitle" id="task-count-subtitle">// loading tasks...</div>
      </div>
      <button class="btn-new-task" onclick="openNewTaskModal()">
        + New Task
      </button>
    </div>

    <!-- Stats -->
    <div class="stats-row">
      <div class="stat-card">
        <div>
          <div class="stat-label">Todo</div>
          <div class="stat-value" id="stat-todo" style="color:var(--todo)">0</div>
        </div>
        <div class="stat-dot" style="background:rgba(124,106,255,0.1)">üìã</div>
      </div>
      <div class="stat-card">
        <div>
          <div class="stat-label">In Progress</div>
          <div class="stat-value" id="stat-inprogress" style="color:var(--inprogress)">0</div>
        </div>
        <div class="stat-dot" style="background:rgba(255,184,106,0.1)">üîÑ</div>
      </div>
      <div class="stat-card">
        <div>
          <div class="stat-label">Done</div>
          <div class="stat-value" id="stat-done" style="color:var(--done)">0</div>
        </div>
        <div class="stat-dot" style="background:rgba(106,255,212,0.1)">‚úÖ</div>
      </div>
    </div>

    <!-- Board -->
    <div class="board">
      <div class="column col-todo">
        <div class="column-header">
          <div class="column-title">
            <div class="column-dot"></div>
            Todo
          </div>
          <div class="column-count" id="count-todo">0</div>
        </div>
        <div class="column-body" id="col-todo-body"></div>
      </div>

      <div class="column col-inprogress">
        <div class="column-header">
          <div class="column-title">
            <div class="column-dot"></div>
            In Progress
          </div>
          <div class="column-count" id="count-inprogress">0</div>
        </div>
        <div class="column-body" id="col-inprogress-body"></div>
      </div>

      <div class="column col-done">
        <div class="column-header">
          <div class="column-title">
            <div class="column-dot"></div>
            Done
          </div>
          <div class="column-count" id="count-done">0</div>
        </div>
        <div class="column-body" id="col-done-body"></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ NEW TASK MODAL ‚îÄ‚îÄ -->
<div class="modal-overlay" id="task-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">New Task</div>
      <button class="modal-close" onclick="closeModal()">√ó</button>
    </div>

    <div class="ai-row">
      <div class="field">
        <label>Title</label>
        <input type="text" id="task-title" placeholder="e.g. Build login page" maxlength="100" />
      </div>
      <button class="btn-ai" onclick="handleAISuggest()" id="ai-btn">
        ‚ú® AI Suggest
      </button>
    </div>

    <div style="display:flex; align-items:center; gap:8px; margin:6px 0 16px">
      <div class="ai-badge">AI</div>
      <div style="font-size:11px; color:var(--text2); font-family:var(--mono)" id="ai-status">
        Type a title and click AI Suggest to auto-generate a description
      </div>
    </div>

    <div class="field">
      <label>Description</label>
      <textarea id="task-desc" placeholder="Task description will appear here..."></textarea>
    </div>

    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px">
      <div class="field">
        <label>Status</label>
        <select id="task-status">
          <option value="todo">Todo</option>
          <option value="in_progress">In Progress</option>
        </select>
      </div>
      <div class="field">
        <label>Time (minutes)</label>
        <input type="number" id="task-minutes" placeholder="0" min="0" />
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn-submit" onclick="handleCreateTask()" id="create-btn">Create Task</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ TOAST CONTAINER ‚îÄ‚îÄ -->
<div class="toast-container" id="toast-container"></div>

<script>
  const API = 'http://127.0.0.1:8000';
  let token = localStorage.getItem('ss_token');
  let currentUser = null;
  let tasks = [];

  // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
  if (token) {
    showApp();
    loadUser().then(() => loadTasks());
  }

  // ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
  function switchTab(tab) {
    document.querySelectorAll('.auth-tab').forEach((t, i) => {
      t.classList.toggle('active', (i === 0 && tab === 'login') || (i === 1 && tab === 'register'));
    });
    document.getElementById('login-form').style.display = tab === 'login' ? 'block' : 'none';
    document.getElementById('register-form').style.display = tab === 'register' ? 'block' : 'none';
    hideAuthError();
  }

  function fillDemo(email, pass) {
    document.getElementById('login-email').value = email;
    document.getElementById('login-password').value = pass;
    switchTab('login');
  }

  function showAuthError(msg) {
    const el = document.getElementById('auth-error');
    el.textContent = msg;
    el.style.display = 'block';
  }

  function hideAuthError() {
    document.getElementById('auth-error').style.display = 'none';
  }

  async function handleLogin() {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;
    if (!email || !password) return showAuthError('Please fill in all fields');

    const btn = document.getElementById('login-btn-text');
    btn.innerHTML = '<span class="spinner"></span>';

    try {
      const res = await fetch(`${API}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.detail || 'Login failed');

      token = data.access_token;
      localStorage.setItem('ss_token', token);
      showApp();
      await loadUser();
      await loadTasks();
    } catch (e) {
      showAuthError(e.message);
    } finally {
      btn.textContent = 'Login';
    }
  }

  async function handleRegister() {
    const email = document.getElementById('reg-email').value.trim();
    const password = document.getElementById('reg-password').value;
    if (!email || !password) return showAuthError('Please fill in all fields');

    const btn = document.getElementById('reg-btn-text');
    btn.innerHTML = '<span class="spinner"></span>';

    try {
      const res = await fetch(`${API}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.detail || 'Registration failed');

      token = data.access_token;
      localStorage.setItem('ss_token', token);
      showApp();
      await loadUser();
      await loadTasks();
      showToast('Account created!', 'success');
    } catch (e) {
      showAuthError(e.message);
    } finally {
      btn.textContent = 'Create Account';
    }
  }

  function handleLogout() {
    token = null;
    currentUser = null;
    tasks = [];
    localStorage.removeItem('ss_token');
    document.getElementById('app-screen').style.display = 'none';
    document.getElementById('auth-screen').style.display = 'flex';
  }

  // ‚îÄ‚îÄ APP ‚îÄ‚îÄ
  function showApp() {
    document.getElementById('auth-screen').style.display = 'none';
    document.getElementById('app-screen').style.display = 'block';
  }

  async function loadUser() {
    try {
      const res = await apiFetch('/users/me');
      currentUser = res;
      document.getElementById('user-email-display').textContent = res.email;
      document.getElementById('user-avatar').textContent = res.email[0].toUpperCase();
    } catch(e) {
      handleLogout();
    }
  }

  async function loadTasks() {
    try {
      tasks = await apiFetch('/tasks/');
      renderBoard();
    } catch(e) {
      showToast('Failed to load tasks', 'error');
    }
  }

  function renderBoard() {
    const todo = tasks.filter(t => t.status === 'todo');
    const inprogress = tasks.filter(t => t.status === 'in_progress');
    const done = tasks.filter(t => t.status === 'done');

    // Stats
    document.getElementById('stat-todo').textContent = todo.length;
    document.getElementById('stat-inprogress').textContent = inprogress.length;
    document.getElementById('stat-done').textContent = done.length;
    document.getElementById('count-todo').textContent = todo.length;
    document.getElementById('count-inprogress').textContent = inprogress.length;
    document.getElementById('count-done').textContent = done.length;
    document.getElementById('task-count-subtitle').textContent = `// ${tasks.length} task${tasks.length !== 1 ? 's' : ''} total`;

    renderColumn('col-todo-body', todo, 'todo');
    renderColumn('col-inprogress-body', inprogress, 'in_progress');
    renderColumn('col-done-body', done, 'done');
  }

  function renderColumn(colId, colTasks, status) {
    const el = document.getElementById(colId);
    if (colTasks.length === 0) {
      el.innerHTML = `<div class="empty-col">// no tasks here</div>`;
      return;
    }

    const NEXT = { todo: 'in_progress', in_progress: 'done' };
    const NEXT_LABEL = { todo: '‚Üí Start', in_progress: '‚Üí Done' };

    el.innerHTML = colTasks.map(task => `
      <div class="task-card">
        <div class="task-title">${escHtml(task.title)}</div>
        ${task.description ? `<div class="task-desc">${escHtml(task.description)}</div>` : ''}
        <div class="task-footer">
          <div class="task-minutes">‚è± ${task.total_minutes}m</div>
          <div class="task-actions">
            ${NEXT[task.status] ? `<button class="task-btn advance" onclick="advanceTask('${task.id}','${NEXT[task.status]}')">${NEXT_LABEL[task.status]}</button>` : ''}
            <button class="task-btn danger" onclick="deleteTask('${task.id}')">‚úï</button>
          </div>
        </div>
      </div>
    `).join('');
  }

  // ‚îÄ‚îÄ TASK ACTIONS ‚îÄ‚îÄ
  async function advanceTask(id, newStatus) {
    try {
      await apiFetch(`/tasks/${id}/status`, 'PATCH', { status: newStatus });
      await loadTasks();
      const label = newStatus === 'in_progress' ? 'In Progress' : 'Done';
      showToast(`Task moved to ${label} ‚úì`, 'success');
    } catch(e) {
      showToast(e.message, 'error');
    }
  }

  async function deleteTask(id) {
    if (!confirm('Delete this task?')) return;
    try {
      await apiFetch(`/tasks/${id}`, 'DELETE');
      await loadTasks();
      showToast('Task deleted', 'info');
    } catch(e) {
      showToast(e.message, 'error');
    }
  }

  // ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ
  function openNewTaskModal() {
    document.getElementById('task-title').value = '';
    document.getElementById('task-desc').value = '';
    document.getElementById('task-status').value = 'todo';
    document.getElementById('task-minutes').value = '';
    document.getElementById('ai-status').textContent = 'Type a title and click AI Suggest to auto-generate a description';
    document.getElementById('task-modal').classList.add('open');
    setTimeout(() => document.getElementById('task-title').focus(), 100);
  }

  function closeModal() {
    document.getElementById('task-modal').classList.remove('open');
  }

  // Close on overlay click
  document.getElementById('task-modal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
  });

  async function handleAISuggest() {
    const title = document.getElementById('task-title').value.trim();
    if (title.length < 3) {
      showToast('Enter at least 3 characters in the title first', 'error');
      return;
    }

    const btn = document.getElementById('ai-btn');
    const statusEl = document.getElementById('ai-status');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span> Thinking...';
    statusEl.innerHTML = '<span class="loading-text">// calling AI model...</span>';

    try {
      const data = await apiFetch('/ai/suggest', 'POST', { title });
      document.getElementById('task-desc').value = data.suggestion;
      statusEl.textContent = `// generated by ${data.model} ‚úì`;
      showToast('AI suggestion applied ‚ú®', 'success');
    } catch(e) {
      statusEl.textContent = '// AI unavailable, write manually';
      showToast('AI suggest failed', 'error');
    } finally {
      btn.disabled = false;
      btn.innerHTML = '‚ú® AI Suggest';
    }
  }

  async function handleCreateTask() {
    const title = document.getElementById('task-title').value.trim();
    const description = document.getElementById('task-desc').value.trim();
    const status = document.getElementById('task-status').value;
    const total_minutes = parseInt(document.getElementById('task-minutes').value) || 0;

    if (!title) { showToast('Title is required', 'error'); return; }

    const btn = document.getElementById('create-btn');
    btn.disabled = true;
    btn.textContent = 'Creating...';

    try {
      await apiFetch('/tasks/', 'POST', { title, description, status, total_minutes });
      closeModal();
      await loadTasks();
      showToast('Task created ‚úì', 'success');
    } catch(e) {
      showToast(e.message, 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'Create Task';
    }
  }

  // ‚îÄ‚îÄ API HELPER ‚îÄ‚îÄ
  async function apiFetch(path, method = 'GET', body = null) {
    const opts = {
      method,
      headers: {
        'Content-Type': 'application/json',
        ...(token ? { Authorization: `Bearer ${token}` } : {}),
      },
    };
    if (body) opts.body = JSON.stringify(body);

    const res = await fetch(`${API}${path}`, opts);

    if (res.status === 204) return null;
    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || `HTTP ${res.status}`);
    return data;
  }

  // ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
  function showToast(message, type = 'info') {
    const icons = { success: '‚úì', error: '‚úï', info: 'i' };
    const colors = { success: 'var(--accent3)', error: 'var(--accent2)', info: 'var(--accent)' };

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
      <span style="color:${colors[type]};font-weight:700">${icons[type]}</span>
      ${message}
    `;

    const container = document.getElementById('toast-container');
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
  }

  // ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
  function escHtml(str) {
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;');
  }

  // Enter key on login
  document.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      const authScreen = document.getElementById('auth-screen');
      if (authScreen.style.display !== 'none') handleLogin();
    }
  });
</script>
</body>
</html>
